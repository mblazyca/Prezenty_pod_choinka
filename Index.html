<!DOCTYPE html>
<html lang="pl">
<head>
  <meta charset="UTF-8">
  <title>Losowanie prezentów świątecznych</title>
  <style>
    table { border-collapse: collapse; margin-top: 10px; }
    td, th { border: 1px solid #444; padding: 5px 10px; text-align: left; }
    th { background: #ddd; }
  </style>
</head>
<body>
  <h1>Losowanie prezentów świątecznych</h1>
  <button id="drawBtn">Wylosuj zestaw</button>
  <div id="result"></div>

  <script>
    // Definicja uczestników i ograniczeń
    const givers = [
      { name: "Dziadek", count: 1 },
      { name: "Babcia", count: 2 },
      { name: "Ciocia Magda", count: 2 },
      { name: "Wujek Mateusz Sz.", count: 2 },
      { name: "Ciocia Marta", count: 2 },
      { name: "Wujek Mateusz B", count: 2 }
    ];
    // Lista wszystkich uczestników (możliwi obdarowani)
    const participants = [
      "Dziadek","Babcia","Ciocia Magda","Wujek Mateusz Sz.",
      "Ciocia Marta","Wujek Mateusz B","Piotr","Paweł","Hanna","Agatka","Jacek"
    ];
    // Ograniczenia: kto nie może kogo wylosować
    const forbidden = {
      "Dziadek": ["Babcia", "Dziadek"],
      "Babcia": ["Dziadek", "Babcia"],
      "Ciocia Magda": ["Wujek Mateusz Sz.", "Agatka", "Jacek", "Ciocia Magda"],
      "Wujek Mateusz Sz.": ["Ciocia Magda", "Agatka", "Jacek", "Wujek Mateusz Sz."],
      "Ciocia Marta": ["Wujek Mateusz B", "Piotr", "Paweł", "Hanna", "Ciocia Marta"],
      "Wujek Mateusz B": ["Ciocia Marta", "Piotr", "Paweł", "Hanna", "Wujek Mateusz B"]
    };

    // Algorytm Fisher-Yates do przetasowania tablicy (losowe permutacje)5
    function shuffle(array) {
      for (let i = array.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1)); // losowy indeks od 0 do i
        [array[i], array[j]] = [array[j], array[i]];   // zamiana miejscami
      }
    }

    // Funkcja wywoływana po kliknięciu przycisku
    document.getElementById("drawBtn").onclick = function() {
      // Przygotowanie listy losujących (powtórzone nazwy według count)
      let giversList = [];
      givers.forEach(g => {
        for (let i = 0; i < g.count; i++) {
          giversList.push(g.name);
        }
      });
      let resultList;
      // Powtarzamy losowanie dopóki warunki nie będą spełnione
      while (true) {
        // Przypisujemy kopię listy uczestników do losowania
        let pool = participants.slice();
        shuffle(pool); // losowe przetasowanie tablicy uczestników
        // Tworzymy przypisanie (lista [losujący, obdarowany])
        let ok = true;
        let pairs = [];
        for (let i = 0; i < giversList.length; i++) {
          let giver = giversList[i];
          let receiver = pool[i];
          // Sprawdzamy ograniczenia
          if (forbidden[giver] && forbidden[giver].includes(receiver)) {
            ok = false; // zabronione skojarzenie
            break;
          }
          pairs.push({ giver: giver, receiver: receiver });
        }
        if (ok) {
          resultList = pairs;
          break; // znaleziono poprawny zestaw
        }
        // inaczej powtarzamy losowanie
      }

      // Budowa tabeli z wynikiem
      const resultDiv = document.getElementById("result");
      resultDiv.innerHTML = ""; // czyścimy poprzedni wynik
      const table = document.createElement("table");
      // Nagłówek tabeli
      const header = table.insertRow();
      let th1 = document.createElement("th");
      th1.textContent = "Losujący";
      header.appendChild(th1);
      let th2 = document.createElement("th");
      th2.textContent = "Obdarowany";
      header.appendChild(th2);
      // Wiersze z parą Losujący → Obdarowany
      resultList.forEach(pair => {
        const row = table.insertRow();
        const cell1 = row.insertCell();
        cell1.textContent = pair.giver;
        const cell2 = row.insertCell();
        cell2.textContent = pair.receiver;
      });
      resultDiv.appendChild(table);
    };
  </script>
</body>
</html>
